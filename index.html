<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sample Size Calculator</title>
    <link rel="stylesheet" href="stylesheets/self.css">
</head>
<body>
    <div class="container" id="main-page">
        <h2>
            <p>Calculating the required sample size for a survey requires that you pick a minimum difference (aka, "delta") between Yes / No responses to your question(s).
            The best way to decide this delta is to ask yourself (or your stakeholders, or your boss),
            <br><br><i>"What's a large-enough difference in responses that we'll actually make a decision?"</i>
            <br><br>A standard for-profit industry delta is 7%. Each additional sample costs money, and a larger delta requires a lower sample size.
            We'll build off of this <a href="http://www.google.com/insights/consumersurveys/view?survey=m7obdzk6ulwbe&question=2&filter=&rw=1" target="blank">example from Google Consumer Surveys</a>, fill in your own delta and question below:</p>
        </h2>
        <hr>
        <form id="sampleSizeForm">
            <p>We want to ask people the yes or no question, 
                <textarea id="control_query" rows="2" cols="50">Is it worth it to pay more for a Mac than a PC with the same specs?</textarea>
            </p>
            <p>We want to run a survey, and we're going to act on those findings even if the delta from "yes" to "no" responses is only 
                <textarea id="diff" rows="1" cols="1">7</textarea> percentage points
            </p>
            <p><button type="submit" style="font-size:16px">What sample size do I need?</button></p>
        </form>
    </div>

    <div class="result" id="result-page">
        <h1 style="text-align:center">You will need:</h1>
        <h3 style="text-align:center" id="sample-size"></h3>
        <h2 style="text-align:center">Now the trick is <a href="http://en.wikipedia.org/wiki/Survey_sampling">getting your sampling right</a>!</h2>
        <p style="text-align:center">
            <button id="back-button">Calculate another</button>
        </p>
    </div>

    <script>
        // This is the p_to_z mapping converted from Python
        const p_to_z = {
            50.0: 0.0000, 50.1: 0.0025, 50.2: 0.0050, 50.3: 0.0075, 50.4: 0.0100, 50.5: 0.0125, 50.6: 0.0150, 50.7: 0.0175, 50.8: 0.0201, 50.9: 0.0226,
            51.0: 0.0251, 51.1: 0.0276, 51.2: 0.0301, 51.3: 0.0326, 51.4: 0.0351, 51.5: 0.0376, 51.6: 0.0401, 51.7: 0.0426, 51.8: 0.0451, 51.9: 0.0476,
            52.0: 0.0502, 52.1: 0.0527, 52.2: 0.0552, 52.3: 0.0577, 52.4: 0.0602, 52.5: 0.0627, 52.6: 0.0652, 52.7: 0.0677, 52.8: 0.0702, 52.9: 0.0728,
            53.0: 0.0753, 53.1: 0.0778, 53.2: 0.0803, 53.3: 0.0828, 53.4: 0.0853, 53.5: 0.0878, 53.6: 0.0904, 53.7: 0.0929, 53.8: 0.0954, 53.9: 0.0979,
            54.0: 0.1004, 54.1: 0.1030, 54.2: 0.1055, 54.3: 0.1080, 54.4: 0.1105, 54.5: 0.1130, 54.6: 0.1156, 54.7: 0.1181, 54.8: 0.1206, 54.9: 0.1231,
            55.0: 0.1257, 55.1: 0.1282, 55.2: 0.1307, 55.3: 0.1332, 55.4: 0.1358, 55.5: 0.1383, 55.6: 0.1408, 55.7: 0.1434, 55.8: 0.1459, 55.9: 0.1484,
            56.0: 0.1510, 56.1: 0.1535, 56.2: 0.1560, 56.3: 0.1586, 56.4: 0.1611, 56.5: 0.1637, 56.6: 0.1662, 56.7: 0.1687, 56.8: 0.1713, 56.9: 0.1738,
            57.0: 0.1764, 57.1: 0.1789, 57.2: 0.1815, 57.3: 0.1840, 57.4: 0.1866, 57.5: 0.1891, 57.6: 0.1917, 57.7: 0.1942, 57.8: 0.1968, 57.9: 0.1993,
            58.0: 0.2019, 58.1: 0.2045, 58.2: 0.2070, 58.3: 0.2096, 58.4: 0.2121, 58.5: 0.2147, 58.6: 0.2173, 58.7: 0.2198, 58.8: 0.2224, 58.9: 0.2250,
            59.0: 0.2275, 59.1: 0.2301, 59.2: 0.2327, 59.3: 0.2353, 59.4: 0.2378, 59.5: 0.2404, 59.6: 0.2430, 59.7: 0.2456, 59.8: 0.2482, 59.9: 0.2508,
            60.0: 0.2533, 60.1: 0.2559, 60.2: 0.2585, 60.3: 0.2611, 60.4: 0.2637, 60.5: 0.2663, 60.6: 0.2689, 60.7: 0.2715, 60.8: 0.2741, 60.9: 0.2767,
            61.0: 0.2793, 61.1: 0.2819, 61.2: 0.2845, 61.3: 0.2871, 61.4: 0.2898, 61.5: 0.2924, 61.6: 0.2950, 61.7: 0.2976, 61.8: 0.3002, 61.9: 0.3029,
            62.0: 0.3055, 62.1: 0.3081, 62.2: 0.3107, 62.3: 0.3134, 62.4: 0.3160, 62.5: 0.3186, 62.6: 0.3213, 62.7: 0.3239, 62.8: 0.3266, 62.9: 0.3292,
            63.0: 0.3319, 63.1: 0.3345, 63.2: 0.3372, 63.3: 0.3398, 63.4: 0.3425, 63.5: 0.3451, 63.6: 0.3478, 63.7: 0.3505, 63.8: 0.3531, 63.9: 0.3558,
            64.0: 0.3585, 64.1: 0.3611, 64.2: 0.3638, 64.3: 0.3665, 64.4: 0.3692, 64.5: 0.3719, 64.6: 0.3745, 64.7: 0.3772, 64.8: 0.3799, 64.9: 0.3826,
            65.0: 0.3853, 65.1: 0.3880, 65.2: 0.3907, 65.3: 0.3934, 65.4: 0.3961, 65.5: 0.3989, 65.6: 0.4016, 65.7: 0.4043, 65.8: 0.4070, 65.9: 0.4097,
            66.0: 0.4125, 66.1: 0.4152, 66.2: 0.4179, 66.3: 0.4207, 66.4: 0.4234, 66.5: 0.4261, 66.6: 0.4289, 66.7: 0.4316, 66.8: 0.4344, 66.9: 0.4372,
            67.0: 0.4399, 67.1: 0.4427, 67.2: 0.4454, 67.3: 0.4482, 67.4: 0.4510, 67.5: 0.4538, 67.6: 0.4565, 67.7: 0.4593, 67.8: 0.4621, 67.9: 0.4649,
            68.0: 0.4677, 68.1: 0.4705, 68.2: 0.4733, 68.3: 0.4761, 68.4: 0.4789, 68.5: 0.4817, 68.6: 0.4845, 68.7: 0.4874, 68.8: 0.4902, 68.9: 0.4930,
            69.0: 0.4959, 69.1: 0.4987, 69.2: 0.5015, 69.3: 0.5044, 69.4: 0.5072, 69.5: 0.5101, 69.6: 0.5129, 69.7: 0.5158, 69.8: 0.5187, 69.9: 0.5215,
            70.0: 0.5244, 70.1: 0.5273, 70.2: 0.5302, 70.3: 0.5330, 70.4: 0.5359, 70.5: 0.5388, 70.6: 0.5417, 70.7: 0.5446, 70.8: 0.5476, 70.9: 0.5505,
            71.0: 0.5534, 71.1: 0.5563, 71.2: 0.5592, 71.3: 0.5622, 71.4: 0.5651, 71.5: 0.5681, 71.6: 0.5710, 71.7: 0.5740, 71.8: 0.5769, 71.9: 0.5799,
            72.0: 0.5828, 72.1: 0.5858, 72.2: 0.5888, 72.3: 0.5918, 72.4: 0.5948, 72.5: 0.5978, 72.6: 0.6008, 72.7: 0.6038, 72.8: 0.6068, 72.9: 0.6098,
            73.0: 0.6128, 73.1: 0.6158, 73.2: 0.6189, 73.3: 0.6219, 73.4: 0.6250, 73.5: 0.6280, 73.6: 0.6311, 73.7: 0.6341, 73.8: 0.6372, 73.9: 0.6403,
            74.0: 0.6433, 74.1: 0.6464, 74.2: 0.6495, 74.3: 0.6526, 74.4: 0.6557, 74.5: 0.6588, 74.6: 0.6620, 74.7: 0.6651, 74.8: 0.6682, 74.9: 0.6713,
            75.0: 0.6745, 75.1: 0.6776, 75.2: 0.6808, 75.3: 0.6840, 75.4: 0.6871, 75.5: 0.6903, 75.6: 0.6935, 75.7: 0.6967, 75.8: 0.6999, 75.9: 0.7031,
            76.0: 0.7063, 76.1: 0.7095, 76.2: 0.7128, 76.3: 0.7160, 76.4: 0.7192, 76.5: 0.7225, 76.6: 0.7257, 76.7: 0.7290, 76.8: 0.7323, 76.9: 0.7356,
            77.0: 0.7388, 77.1: 0.7421, 77.2: 0.7454, 77.3: 0.7488, 77.4: 0.7521, 77.5: 0.7554, 77.6: 0.7588, 77.7: 0.7621, 77.8: 0.7655, 77.9: 0.7688,
            78.0: 0.7722, 78.1: 0.7756, 78.2: 0.7790, 78.3: 0.7824, 78.4: 0.7858, 78.5: 0.7892, 78.6: 0.7926, 78.7: 0.7961, 78.8: 0.7995, 78.9: 0.8030,
            79.0: 0.8064, 79.1: 0.8099, 79.2: 0.8134, 79.3: 0.8169, 79.4: 0.8204, 79.5: 0.8239, 79.6: 0.8274, 79.7: 0.8310, 79.8: 0.8345, 79.9: 0.8381,
            80.0: 0.8416, 80.1: 0.8452, 80.2: 0.8488, 80.3: 0.8524, 80.4: 0.8560, 80.5: 0.8596, 80.6: 0.8633, 80.7: 0.8669, 80.8: 0.8705, 80.9: 0.8742,
            81.0: 0.8779, 81.1: 0.8816, 81.2: 0.8853, 81.3: 0.8890, 81.4: 0.8927, 81.5: 0.8965, 81.6: 0.9002, 81.7: 0.9040, 81.8: 0.9078, 81.9: 0.9116,
            82.0: 0.9154, 82.1: 0.9192, 82.2: 0.9230, 82.3: 0.9269, 82.4: 0.9307, 82.5: 0.9346, 82.6: 0.9385, 82.7: 0.9424, 82.8: 0.9463, 82.9: 0.9502,
            83.0: 0.9542, 83.1: 0.9581, 83.2: 0.9621, 83.3: 0.9661, 83.4: 0.9701, 83.5: 0.9741, 83.6: 0.9782, 83.7: 0.9822, 83.8: 0.9863, 83.9: 0.9904,
            84.0: 0.9945, 84.1: 0.9986, 84.2: 1.0027, 84.3: 1.0069, 84.4: 1.0110, 84.5: 1.0152, 84.6: 1.0194, 84.7: 1.0237, 84.8: 1.0279, 84.9: 1.0322,
            85.0: 1.0364, 85.1: 1.0407, 85.2: 1.0450, 85.3: 1.0494, 85.4: 1.0537, 85.5: 1.0581, 85.6: 1.0625, 85.7: 1.0669, 85.8: 1.0714, 85.9: 1.0758,
            86.0: 1.0803, 86.1: 1.0848, 86.2: 1.0893, 86.3: 1.0939, 86.4: 1.0985, 86.5: 1.1031, 86.6: 1.1077, 86.7: 1.1123, 86.8: 1.1170, 86.9: 1.1217,
            87.0: 1.1264, 87.1: 1.1311, 87.2: 1.1359, 87.3: 1.1407, 87.4: 1.1455, 87.5: 1.1503, 87.6: 1.1552, 87.7: 1.1601, 87.8: 1.1650, 87.9: 1.1700,
            88.0: 1.1750, 88.1: 1.1800, 88.2: 1.1850, 88.3: 1.1901, 88.4: 1.1952, 88.5: 1.2004, 88.6: 1.2055, 88.7: 1.2107, 88.8: 1.2160, 88.9: 1.2212,
            89.0: 1.2265, 89.1: 1.2319, 89.2: 1.2372, 89.3: 1.2426, 89.4: 1.2481, 89.5: 1.2536, 89.6: 1.2591, 89.7: 1.2646, 89.8: 1.2702, 89.9: 1.2759,
            90.0: 1.2816, 90.1: 1.2873, 90.2: 1.2930, 90.3: 1.2988, 90.4: 1.3047, 90.5: 1.3106, 90.6: 1.3165, 90.7: 1.3225, 90.8: 1.3285, 90.9: 1.3346,
            91.0: 1.3408, 91.1: 1.3469, 91.2: 1.3532, 91.3: 1.3595, 91.4: 1.3658, 91.5: 1.3722, 91.6: 1.3787, 91.7: 1.3852, 91.8: 1.3917, 91.9: 1.3984,
            92.0: 1.4051, 92.1: 1.4118, 92.2: 1.4187, 92.3: 1.4255, 92.4: 1.4325, 92.5: 1.4395, 92.6: 1.4466, 92.7: 1.4538, 92.8: 1.4611, 92.9: 1.4684,
            93.0: 1.4758, 93.1: 1.4833, 93.2: 1.4909, 93.3: 1.4985, 93.4: 1.5063, 93.5: 1.5141, 93.6: 1.5220, 93.7: 1.5301, 93.8: 1.5382, 93.9: 1.5464,
            94.0: 1.5548, 94.1: 1.5632, 94.2: 1.5718, 94.3: 1.5805, 94.4: 1.5893, 94.5: 1.5982, 94.6: 1.6072, 94.7: 1.6164, 94.8: 1.6258, 94.9: 1.6352,
            95.0: 1.6449, 95.1: 1.6546, 95.2: 1.6646, 95.3: 1.6747, 95.4: 1.6849, 95.5: 1.6954, 95.6: 1.7060, 95.7: 1.7169, 95.8: 1.7279, 95.9: 1.7392,
            96.0: 1.7507, 96.1: 1.7624, 96.2: 1.7744, 96.3: 1.7866, 96.4: 1.7991, 96.5: 1.8119, 96.6: 1.8250, 96.7: 1.8384, 96.8: 1.8522, 96.9: 1.8663,
            97.0: 1.8808, 97.1: 1.8957, 97.2: 1.9110, 97.3: 1.9268, 97.4: 1.9431, 97.5: 1.9600, 97.6: 1.9774, 97.7: 1.9954, 97.8: 2.0141, 97.9: 2.0335,
            98.0: 2.0537, 98.1: 2.0749, 98.2: 2.0969, 98.3: 2.1201, 98.4: 2.1444, 98.5: 2.1701, 98.6: 2.1973, 98.7: 2.2262, 98.8: 2.2571, 98.9: 2.2904,
            99.0: 2.3263, 99.1: 2.3656, 99.2: 2.4089, 99.3: 2.4573, 99.4: 2.5121, 99.5: 2.5758, 99.6: 2.6521, 99.7: 2.7478, 99.8: 2.8782, 99.9: 3.0902
        };

        // Function to calculate sample size
        function calculateSampleSize(ci, controlProportion, confidence) {
            // The below takes the one-tailed probability and makes it two-tailed
            const confMod = (100 - confidence) / 2;
            confidence += confMod;
            
            // Get the z-score for the confidence level
            const zScore = p_to_z[confidence];
            
            // Calculate the sample size
            const sampleSize = (controlProportion - Math.pow(controlProportion, 2)) / Math.pow((ci / zScore), 2);
            
            // Return the ceiling of the sample size
            return Math.ceil(sampleSize);
        }

        // Form submission handler
        document.getElementById('sampleSizeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get the values from the form
            const ci = parseFloat(document.getElementById('diff').value) / 100;
            const controlProportion = 0.50; // Fixed at 50% as in the original code
            const confidence = 95; // Fixed at 95% as in the original code
            
            // Calculate the sample size
            const sampleSize = calculateSampleSize(ci, controlProportion, confidence);
            
            // Display the result
            document.getElementById('sample-size').textContent = sampleSize + " samples";
            
            // Show the result page and hide the main page
            document.getElementById('main-page').style.display = 'none';
            document.getElementById('result-page').style.display = 'block';
        });

        // Back button handler
        document.getElementById('back-button').addEventListener('click', function() {
            // Show the main page and hide the result page
            document.getElementById('main-page').style.display = 'block';
            document.getElementById('result-page').style.display = 'none';
        });
    </script>
</body>
</html>
